<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tony Drew for the Gold!</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Oswald:wght@500;700&display=swap" rel="stylesheet">

<style>
:root{
  --brand:#FFC907;
  --bg:#f7f7f7;
  --card:#ffffff;
  --border:#e8e8e8;
  --name-col:120px;
  --lane-h:150px;
  --avatar-size:110px;       /* headshot size */
  --avatar-lift:26px;        /* drop headshots a bit */
  --maxw:980px;
}
*{box-sizing:border-box}
body{margin:0;padding:18px 12px 36px;font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:#111;}
.wrap{max-width:var(--maxw);margin:0 auto;}

header{text-align:center;margin-bottom:12px;}
header h1{font-family:Oswald,Impact,Haettenschweiler,'Arial Narrow Bold',sans-serif;font-size:clamp(26px,5vw,40px);margin:0 0 6px;}
header .lead{margin:0 0 6px;font-size:clamp(14px,3.2vw,16px);line-height:1.4;}
header .nudge{font-size:13px;color:#666;margin-top:4px;font-style:italic;}

/* CTA line: inline pointer, yellow text; only "Here" blue */
header .cta-inline{
  display:inline-flex;align-items:center;justify-content:center;gap:4px;
  font-size:clamp(15px,3.4vw,18px);font-weight:700;color:var(--brand);
}
header .cta-inline a{
  color:#0a58ca;text-decoration:none;border-bottom:1px dotted currentColor;
}
header .cta-inline a:hover{ text-decoration:underline; }

/* Campaign progress */
.campaign{margin:14px auto 8px;max-width:520px;}
.campaign-bar{height:10px;border-radius:6px;background:#e1e1e1;overflow:hidden;}
.campaign-fill{height:100%;width:0%;background:var(--brand);transition:width 1s ease;}
.campaign-labels{display:flex;justify-content:space-between;font-size:12.5px;color:#555;margin-top:4px;padding:0 2px;}

/* Lanes */
.board{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px;box-shadow:0 1px 2px rgba(0,0,0,.04);}
.lane{
  display:grid; grid-template-columns:var(--name-col) 1fr; column-gap:0;
  align-items:center; background:#fff; border:2px dotted var(--brand);
  border-radius:12px; padding:10px; min-height:var(--lane-h); margin:8px 0; overflow:visible;
}
.name{font-family:Oswald,system-ui;font-size:clamp(16px,3.4vw,20px);padding:0 8px 0 4px;word-break:break-word;}

.track-area{
  position:relative; height:calc(var(--lane-h) - 22px); border-radius:10px;
  /* Midpoint glow to motivate progress */
  background: linear-gradient(to right, #fff 0%, #fff 45%, #fff4bf 70%, #fff4bf 100%);
  overflow:visible; display:flex; align-items:center;
}
.start-line{
  position:absolute; left:-8px; top:0; bottom:0; width:3px; background:var(--brand); border-radius:2px;
}
.finish-line{
  position:absolute; right:0; top:0; bottom:0; width:3px;
  background:repeating-linear-gradient(to bottom, var(--brand), var(--brand) 6px, #ffffff 6px, #ffffff 12px);
  border-radius:2px;
}

/* Tony emphasis (follows lane via data-name) */
.lane[data-name="Tony Drew"] .track-area{
  background: linear-gradient(to right, #fff 0%, #fff 45%, #fff1a6 70%, #fff1a6 100%);
  box-shadow: inset 0 0 12px rgba(255,201,7,.4);
}
.lane[data-name="Tony Drew"] .name{ color:#d4a300; font-weight:700; }

/* Avatars */
.avatar{
  position:absolute; z-index:20; top:calc(50% + var(--avatar-lift)); transform:translateY(-50%);
  transition:left 1.5s cubic-bezier(.4,0,.2,1), top .6s ease; pointer-events:none;
}
.avatar img{
  height:var(--avatar-size); width:auto; border-radius:12px; border:3px solid var(--brand);
  background:#fff; box-shadow:0 4px 10px rgba(0,0,0,.25); object-fit:cover;
  animation:bob 2.2s ease-in-out infinite; will-change:transform;
}
@keyframes bob{0%,100%{transform:translateY(-50%)}50%{transform:translateY(calc(-50% - 4px))}}
@media (prefers-reduced-motion: reduce){.avatar img{animation:none !important}}

/* Progress badge */
.progress{
  position:absolute; right:8px; bottom:8px; background:#fff; border:1px solid var(--border);
  padding:4px 10px; border-radius:10px; font-size:13.5px; font-weight:600; color:#222; white-space:nowrap;
}

/* CTA emoji that follows Tony */
.cta-emoji{
  position:absolute; z-index:30; top:calc(50% + var(--avatar-lift)); transform:translateY(-50%);
  font-size:28px; line-height:1; text-decoration:none;
  filter: drop-shadow(0 2px 3px rgba(0,0,0,.2));
  animation:bob 2.2s ease-in-out infinite;
}
.cta-emoji:focus{outline:2px solid #0a58ca;border-radius:6px}

/* Footer */
footer{margin-top:20px;text-align:center;color:#444;font-size:13px;line-height:1.4;}
footer small{display:block;margin-bottom:10px;font-size:12.5px;color:#666;letter-spacing:.2px;font-style:italic;}
footer .org-info a{color:#0a58ca;text-decoration:none;border-bottom:1px dotted currentColor;}
footer .org-info a:hover{text-decoration:underline;}

/* Responsive tweaks */
@media (max-width:900px){ :root{ --name-col:130px; } }
@media (max-width:640px){
  :root{ --name-col:110px; --lane-h:132px; }
  .board{padding:10px}
  .progress{ font-size:12.5px; padding:3px 8px; }
}
@media (max-width:420px){
  :root{ --name-col:96px; --lane-h:128px; }
  .progress{ font-size:12px; padding:3px 8px; }
}
@media (max-width:360px){
  :root{ --name-col:88px; --lane-h:124px; }
  .progress{ font-size:11.5px; padding:3px 7px; right:6px; bottom:6px; }
}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Tony Drew for the Gold! üèÜ</h1>

      <!-- CTA line with inline pointer, only 'Here' blue -->
      <p class="lead">
        <span class="cta-inline">
          üëâ <span>Donate <a href="https://givebutter.com/fO5IHJ/tony-drew" target="_blank" rel="noopener">Here</a> to Team Tony Drew</span>
        </span>
      </p>
      <p class="lead"><strong>HD Supply Helping Hand</strong></p>
      <p class="nudge">Your donation counts toward Tony‚Äôs total‚Äîhelp him cross the finish line!</p>
    </header>

    <!-- Campaign timeline -->
    <div class="campaign" aria-label="Campaign timeline">
      <div class="campaign-bar"><div class="campaign-fill" id="campaignFill"></div></div>
      <div class="campaign-labels"><span>Start Oct 1</span><span>Finish Oct 31</span></div>
    </div>

    <!-- Leaderboard -->
    <section class="board" id="leaderboard">
      <!-- First names shown; full names in data-name to match CSV -->
      <div class="lane" data-name="Sheila Schnellenberger">
        <div class="name">Sheila</div>
        <div class="track-area">
          <div class="start-line"></div><div class="finish-line"></div>
          <div class="avatar"><img src="img/sheila.PNG" alt="Sheila headshot"></div>
          <div class="progress">$0 / $10,000</div>
        </div>
      </div>

      <div class="lane" data-name="Chris Kelley">
        <div class="name">Chris</div>
        <div class="track-area">
          <div class="start-line"></div><div class="finish-line"></div>
          <div class="avatar"><img src="img/chris.PNG" alt="Chris headshot"></div>
          <div class="progress">$0 / $10,000</div>
        </div>
      </div>

      <div class="lane" data-name="Tony Drew">
        <div class="name">Tony</div>
        <div class="track-area">
          <div class="start-line"></div><div class="finish-line"></div>
          <!-- Clickable emoji that follows Tony -->
          <a class="cta-emoji" id="tonyCta" href="https://givebutter.com/fO5IHJ/tony-drew" target="_blank" rel="noopener" aria-label="Donate to Team Tony">üëâ</a>
          <div class="avatar"><img src="img/tony.PNG" alt="Tony headshot"></div>
          <div class="progress">$0 / $10,000</div>
        </div>
      </div>

      <div class="lane" data-name="John Drake">
        <div class="name">John</div>
        <div class="track-area">
          <div class="start-line"></div><div class="finish-line"></div>
          <div class="avatar"><img src="img/john.PNG" alt="John headshot"></div>
          <div class="progress">$0 / $10,000</div>
        </div>
      </div>

      <div class="lane" data-name="Sami Nassar">
        <div class="name">Sami</div>
        <div class="track-area">
          <div class="start-line"></div><div class="finish-line"></div>
          <div class="avatar"><img src="img/sami.PNG" alt="Sami headshot"></div>
          <div class="progress">$0 / $10,000</div>
        </div>
      </div>

      <div class="lane" data-name="Travis Lawrence">
        <div class="name">Travis</div>
        <div class="track-area">
          <div class="start-line"></div><div class="finish-line"></div>
          <div class="avatar"><img src="img/travis.PNG" alt="Travis headshot"></div>
          <div class="progress">$0 / $10,000</div>
        </div>
      </div>

      <div class="lane" data-name="Charles DSouza">
        <div class="name">Charles</div>
        <div class="track-area">
          <div class="start-line"></div><div class="finish-line"></div>
          <div class="avatar"><img src="img/charles.PNG" alt="Charles headshot"></div>
          <div class="progress">$0 / $10,000</div>
        </div>
      </div>

      <div class="lane" data-name="Dan McDevitt">
        <div class="name">Dan</div>
        <div class="track-area">
          <div class="start-line"></div><div class="finish-line"></div>
          <div class="avatar"><img src="img/dan.PNG" alt="Dan headshot"></div>
          <div class="progress">$0 / $10,000</div>
        </div>
      </div>

      <div class="lane" data-name="Scott Boher">
        <div class="name">Scott</div>
        <div class="track-area">
          <div class="start-line"></div><div class="finish-line"></div>
          <div class="avatar"><img src="img/scott.PNG" alt="Scott headshot"></div>
          <div class="progress">$0 / $10,000</div>
        </div>
      </div>
    </section>

    <footer>
      <small id="lastUpdated"></small>
      <div class="org-info">
        HD Supply Charitable Fund, Inc<br>
        A 501(c)(3) Public Charity<br>
        EIN 42-1745656<br>
        <a href="https://hdsupply.com" target="_blank" rel="noopener">Visit HD Supply</a>
      </div>
    </footer>
  </div>

<script>
/* Campaign timeline fill (Oct 1 ‚Üí Oct 31) */
(function(){
  const start=new Date("2025-10-01T00:00:00");
  const end=new Date("2025-10-31T23:59:59");
  const fill=document.getElementById('campaignFill');
  function update(){
    const now=new Date(); let pct=0;
    if(now<=start) pct=0; else if(now>=end) pct=100; else pct=((now-start)/(end-start))*100;
    if(fill) fill.style.width=pct.toFixed(1)+"%";
  }
  update();
  setInterval(update, 60*60*1000);
  document.addEventListener('visibilitychange',()=>!document.hidden && update());
})();

/* CSV ‚Üí auto-rank ‚Üí layout; timestamp; Tony confetti; intro race */
(function () {
  const CSV_URL="https://raw.githubusercontent.com/epmo-ps/SLT/main/slt.csv";
  const bust=url=>url+(url.includes("?")?"&":"?")+"t="+Date.now();

  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const fmt=n=>Number(String(n||0).replace(/,/g,'')||0).toLocaleString('en-US',{maximumFractionDigits:0});
  let laneData=[];
  let didIntro=false;
  let prevTonyRaised=0;
  let introQueued=false;

  function parseCSV(text){
    const lines=text.trim().split(/\r?\n/);
    if(!lines.length) return [];
    const headers=lines.shift().split(',').map(h=>h.trim());
    return lines.map(line=>{
      const cells=line.split(',').map(c=>c.trim());
      const row={}; headers.forEach((h,i)=>row[h]=cells[i]||'');
      return row;
    });
  }

  function setTimestamp(){
    const el=document.getElementById('lastUpdated'); if(!el) return;
    const now=new Date();
    const datePart = now.toLocaleDateString([], {month:'short', day:'2-digit'});
    const timePart = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    el.textContent = `Updated ${datePart}, ${timePart}`;
  }

  async function fetchRows(){
    const resp=await fetch(bust(CSV_URL),{cache:'no-store'});
    const text=await resp.text();
    return parseCSV(text);
  }

  function mapLanes(rows){
    const map=new Map(rows.map(r=>[r.Name,r]));
    const lanes=[...document.querySelectorAll('.lane[data-name]')];
    laneData=lanes.map(lane=>{
      const name=lane.getAttribute('data-name');
      const d=map.get(name)||{};
      const raised=Number(String(d.Raised||'0').replace(/,/g,''));
      const goal=Number(String(d.Goal||'10000').replace(/,/g,''));
      return { lane, name, raised, goal };
    });

    // Confetti if Tony increased
    const tonyRow = rows.find(r => (r.Name||'').toLowerCase()==='tony drew');
    if(tonyRow){
      const currentRaised = Number(String(tonyRow.Raised||'0').replace(/,/g,''));
      if(currentRaised > prevTonyRaised){ confettiBurst(); }
      prevTonyRaised = currentRaised;
    }
  }

  function rankLanes(){
    laneData.sort((a,b)=>b.raised-a.raised);
    const board=document.querySelector('#leaderboard');
    laneData.forEach(({lane})=>board.appendChild(lane));
  }

  function geometryFor(lane){
    const track=lane.querySelector('.track-area');
    const startLine=lane.querySelector('.start-line');
    const label=lane.querySelector('.progress');
    const avatar=lane.querySelector('.avatar');
    if(!track||!startLine||!label||!avatar) return null;

    const trackRect = track.getBoundingClientRect();
    const lineRect  = startLine.getBoundingClientRect();
    const startX = Math.max(0, lineRect.right - trackRect.left) + 2;

    const trackW  = track.clientWidth;
    const labelW  = label.offsetWidth;
    const avatarW = avatar.getBoundingClientRect().width || 72;

    const minCenterX = startX + (avatarW/2);
    const maxCenterX = Math.max(minCenterX, trackW - labelW - 10 - (avatarW/2));
    return {track, label, avatar, minCenterX, maxCenterX, avatarW};
  }

  function layout(){
    laneData.forEach(({lane, raised, goal})=>{
      const g = geometryFor(lane); if(!g) return;

      const pct=clamp(goal>0 ? (raised/goal)*100 : 0, 0, 100);
      const centerX = g.minCenterX + (pct/100) * (g.maxCenterX - g.minCenterX);

      g.avatar.style.left = (centerX - g.avatarW/2) + "px";
      const label=lane.querySelector('.progress');
      label.textContent = `$${fmt(raised)} / $${fmt(goal)}`;

      // Move Tony's emoji pointer to follow him
      if((lane.getAttribute('data-name')||'').toLowerCase()==='tony drew'){
        const cta=document.getElementById('tonyCta');
        if(cta){ cta.style.left = (centerX - g.avatarW/2 - 40) + 'px'; }
      }
    });
  }

  // Intro: race to finish then back to real positions (first load only / fallback)
  async function raceIntro(){
    if(didIntro) return; didIntro=true;
    await new Promise(r=>setTimeout(r,200));
    laneData.forEach(({lane})=>{
      const g = geometryFor(lane); if(!g) return;
      const finishLeft = (g.maxCenterX - g.avatarW/2) + 'px';
      g.avatar.style.left = finishLeft;
      if((lane.getAttribute('data-name')||'').toLowerCase()==='tony drew'){
        const cta=document.getElementById('tonyCta');
        if(cta) cta.style.left = (g.maxCenterX - g.avatarW/2 - 40) + 'px';
      }
    });
    await new Promise(r=>setTimeout(r,1400));
    layout();
  }

  function confettiBurst(){
    const duration = 1200;
    const end = Date.now() + duration;
    (function frame(){
      const timeLeft = end - Date.now();
      if(timeLeft<=0) return;
      const particle = document.createElement('div');
      particle.textContent = ['üéâ','‚ú®','üíõ','‚≠ê'][Math.floor(Math.random()*4)];
      particle.style.position='fixed';
      particle.style.left=(Math.random()*100)+'vw';
      particle.style.top='0';
      particle.style.fontSize='20px';
      particle.style.opacity=1;
      particle.style.transition='transform 1.2s ease-out, opacity 1.2s ease-out';
      document.body.appendChild(particle);
      setTimeout(()=>{
        particle.style.transform=`translateY(${100+Math.random()*300}px) rotate(${Math.random()*720-360}deg)`;
        particle.style.opacity=0;
      },10);
      setTimeout(()=>particle.remove(),1200);
      if(Date.now()<end) requestAnimationFrame(frame);
    })();
  }
let lastCsvText = ""; // cache of previous CSV

async function loadAndRender(){
  try{
    const resp = await fetch(bust(CSV_URL), {cache:'no-store'});
    const text = await resp.text();

    // only proceed if data actually changed
    if (text !== lastCsvText) {
      lastCsvText = text;
      const rows = parseCSV(text);
      mapLanes(rows);
      rankLanes();
      layout();
      setTimestamp(); // <-- update only on change
      console.log("Data changed ‚Äî layout + timestamp refreshed");
    } else {
      console.log("No change ‚Äî skipped timestamp update");
    }

    // Fallback: if no user interaction, still show the intro race once
    if(!introQueued){
      introQueued=true;
      setTimeout(()=>{ if(!didIntro) raceIntro(); }, 1500);
    }
  } catch(e){
    console.error('Failed to load CSV:', e);
  }
}
      // Fallback: if no user interaction, still show the intro race once
      if(!introQueued){
        introQueued=true;
        setTimeout(()=>{ if(!didIntro) raceIntro(); }, 1500);
      }
    }catch(e){
      console.error('Failed to load CSV:', e);
    }
  }

  loadAndRender();
  window.addEventListener('resize', layout);
  setInterval(loadAndRender, 60*1000);
  document.addEventListener('visibilitychange',()=>!document.hidden && loadAndRender());
})();
</script>
</body>
</html>
